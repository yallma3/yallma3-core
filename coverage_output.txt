
> yallma3-core@1.0.0 test:coverage
> vitest run --coverage


 RUN  v2.1.9 /home/assem/work/yaLLMa3/yallma3-core
      Coverage enabled with v8

stdout | tests/unit/agent/AgentRuntime.test.ts > AgentRuntime > run > should complete task on first iteration when review passes
CONTEXRTT test context
Iteration: 0
ğŸ§  Agent Response:  Agent response

stdout | tests/unit/agent/AgentRuntime.test.ts > AgentRuntime > run > should iterate when review indicates needs revision
CONTEXRTT test context
Iteration: 0
ğŸ§  Agent Response:  First response
Iteration: 1
ğŸ§  Agent Response:  Improved response

stdout | tests/unit/agent/AgentRuntime.test.ts > AgentRuntime > run > should stop at max iterations
CONTEXRTT test context
Iteration: 0
ğŸ§  Agent Response:  Response 0
Iteration: 1
ğŸ§  Agent Response:  Response 2
Iteration: 2
ğŸ§  Agent Response:  Response 4
Iteration: 3
ğŸ§  Agent Response:  Response 6
Iteration: 4
ğŸ§  Agent Response:  Response 8

stdout | tests/unit/agent/AgentRuntime.test.ts > Yallma3GenOneAgentRuntime > run > should register tools when agent has tools

ğŸ”„ Iteration 1/1
ğŸ§  Agent Response:
 Agent response
ğŸ” Review Result: {
  "task_completion_status": "complete",
  "feedback": "Good job"
}
ğŸ‰ Task marked complete by reviewer.

stdout | tests/unit/agent/AgentRuntime.test.ts > Yallma3GenOneAgentRuntime > run > should complete task when review passes

ğŸ”„ Iteration 1/1
ğŸ§  Agent Response:
 Agent response
ğŸ” Review Result: {
  "task_completion_status": "complete",
  "feedback": "Good job"
}
ğŸ‰ Task marked complete by reviewer.

stdout | tests/unit/agent/AgentRuntime.test.ts > Yallma3GenOneAgentRuntime > run > should perform final check when review suggests revision

ğŸ”„ Iteration 1/1
ğŸ§  Agent Response:
 Agent response
ğŸ” Review Result: {
  "task_completion_status": "needs_revision",
  "feedback": "Needs improvement"
}
âœ… Final Check: {
  "accept": true,
  "reason": "Good enough",
  "next_action": "deliver"
}
ğŸ‰ Task accepted by final check.

stdout | tests/unit/agent/AgentRuntime.test.ts > Yallma3GenOneAgentRuntime > run > should accept response when final check passes

ğŸ”„ Iteration 1/1
ğŸ§  Agent Response:
 Agent response
ğŸ” Review Result: {
  "task_completion_status": "needs_revision",
  "feedback": "Needs improvement"
}
âœ… Final Check: {
  "accept": true,
  "reason": "Good enough",
  "next_action": "deliver"
}
ğŸ‰ Task accepted by final check.

stdout | tests/unit/agent/AgentRuntime.test.ts > Yallma3GenOneAgentRuntime > run > should handle JSON parsing errors in review

ğŸ”„ Iteration 1/1
ğŸ§  Agent Response:
 Agent response

 âœ“ tests/unit/agent/AgentRuntime.test.ts (18 tests) 24ms
 âœ“ tests/unit/nodes/ConsoleInput.test.ts (12 tests) 10ms
stdout | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > process - extract_field > should extract simple field
Executing JSONManipulator node 1
Operation: extract_field, Field Path: title, Output Format: string
JSON manipulation completed successfully

stdout | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > process - extract_field > should extract nested field
Executing JSONManipulator node 1
Operation: extract_field, Field Path: data.name, Output Format: string
JSON manipulation completed successfully

stdout | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > process - extract_field > should extract array field
Executing JSONManipulator node 1
Operation: extract_field, Field Path: items, Output Format: array
JSON manipulation completed successfully

stdout | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > process - extract_field > should extract field from array elements
Executing JSONManipulator node 1
Operation: extract_field, Field Path: value, Output Format: array
JSON manipulation completed successfully

stdout | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > process - extract_array > should extract array field
Executing JSONManipulator node 1
Operation: extract_array, Field Path: items, Output Format: array
JSON manipulation completed successfully

stdout | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > process - filter > should filter by contains condition
Executing JSONManipulator node 1
Operation: filter, Field Path: items, Output Format: array
JSON manipulation completed successfully

stdout | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > process - filter > should filter by greater than condition
Executing JSONManipulator node 1
Operation: filter, Field Path: items, Output Format: array
JSON manipulation completed successfully

stdout | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > process - filter > should filter by equals condition
Executing JSONManipulator node 1
Operation: filter, Field Path: items, Output Format: array
JSON manipulation completed successfully

stdout | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > process - count > should count items in array
Executing JSONManipulator node 1
Operation: count, Field Path: items, Output Format: string
JSON manipulation completed successfully

stdout | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > process - count > should count items in nested array
Executing JSONManipulator node 1
Operation: count, Field Path: data.values, Output Format: string
JSON manipulation completed successfully

stdout | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > process - count > should count top-level items
Executing JSONManipulator node 1
Operation: count, Field Path: data.values, Output Format: count
JSON manipulation completed successfully

stdout | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > process - transform > should transform array items
Executing JSONManipulator node 1
Operation: transform, Field Path: name, Output Format: array
JSON manipulation completed successfully

stdout | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > error handling > should handle invalid JSON input
Executing JSONManipulator node 1
Operation: extract_field, Field Path: title, Output Format: array

stderr | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > error handling > should handle invalid JSON input
Error in JSONManipulator node: Error: Invalid JSON input: Unexpected token 'i', "invalid json" is not valid JSON
    at Object.process (/home/assem/work/yaLLMa3/yallma3-core/Workflow/Nodes/JSONManipulatorNode.ts:144:17)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at /home/assem/work/yaLLMa3/yallma3-core/tests/unit/nodes/JSONManipulatorNode.test.ts:266:22
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1271:3)

stdout | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > error handling > should handle non-string input
Executing JSONManipulator node 1

stderr | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > error handling > should handle non-string input
Error in JSONManipulator node: Error: JSON input is required and must be a string
    at Object.process (/home/assem/work/yaLLMa3/yallma3-core/Workflow/Nodes/JSONManipulatorNode.ts:119:17)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at /home/assem/work/yaLLMa3/yallma3-core/tests/unit/nodes/JSONManipulatorNode.test.ts:278:22
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1271:3)

stdout | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > error handling > should handle missing input
Executing JSONManipulator node 1

stderr | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > error handling > should handle missing input
Error in JSONManipulator node: Error: JSON input is required and must be a string
    at Object.process (/home/assem/work/yaLLMa3/yallma3-core/Workflow/Nodes/JSONManipulatorNode.ts:119:17)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at /home/assem/work/yaLLMa3/yallma3-core/tests/unit/nodes/JSONManipulatorNode.test.ts:290:22
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1271:3)

stdout | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > error handling > should handle unsupported operation
Executing JSONManipulator node 1
Operation: unsupported_op, Field Path: title, Output Format: array

stderr | tests/unit/nodes/JSONManipulatorNode.test.ts > JSONManipulatorNode > error handling > should handle unsupported operation
Error in JSONManipulator node: Error: Unsupported operation: unsupported_op
    at Object.process (/home/assem/work/yaLLMa3/yallma3-core/Workflow/Nodes/JSONManipulatorNode.ts:173:19)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at /home/assem/work/yaLLMa3/yallma3-core/tests/unit/nodes/JSONManipulatorNode.test.ts:302:22
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1271:3)

 âœ“ tests/unit/llm/OpenAIProvider.test.ts (10 tests) 20ms
 âœ“ tests/unit/nodes/JSONManipulatorNode.test.ts (20 tests) 26ms
stderr | tests/unit/utils/Mcp.test.ts > Mcp Utils > getTools > should throw error when listTools fails
[MCP] Failed to get tools: Error: Failed to list tools
    at /home/assem/work/yaLLMa3/yallma3-core/tests/unit/utils/Mcp.test.ts:60:21
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1262:5)

stderr | tests/unit/utils/Mcp.test.ts > Mcp Utils > callTool > should throw error when callTool fails
[MCP] Failed to call tool: failingTool Error: Tool call failed
    at /home/assem/work/yaLLMa3/yallma3-core/tests/unit/utils/Mcp.test.ts:99:21
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1262:5)

stderr | tests/unit/utils/Mcp.test.ts > Mcp Utils > getPrompts > should throw error when listPrompts fails
[MCP] Failed to get prompts: Error: Failed to list prompts
    at /home/assem/work/yaLLMa3/yallma3-core/tests/unit/utils/Mcp.test.ts:141:21
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1262:5)

stderr | tests/unit/utils/Mcp.test.ts > Mcp Utils > getPrompt > should throw error when getPrompt fails
[MCP] Failed to get prompt: failingPrompt Error: Failed to get prompt
    at /home/assem/work/yaLLMa3/yallma3-core/tests/unit/utils/Mcp.test.ts:173:21
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1262:5)

stderr | tests/unit/utils/Mcp.test.ts > Mcp Utils > getResources > should throw error when listResources fails
[MCP] Failed to get resources: Error: Failed to list resources
    at /home/assem/work/yaLLMa3/yallma3-core/tests/unit/utils/Mcp.test.ts:215:21
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1262:5)

stderr | tests/unit/utils/Mcp.test.ts > Mcp Utils > getResource > should throw error when readResource fails
[MCP] Failed to get resource: invalid://uri Error: Failed to read resource
    at /home/assem/work/yaLLMa3/yallma3-core/tests/unit/utils/Mcp.test.ts:243:21
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1262:5)

 âœ“ tests/unit/utils/Mcp.test.ts (12 tests) 28ms
stdout | tests/integration/routes/mcp.route.test.ts > MCP Routes > POST /api/mcp/health > should return health status for STDIO type
[HealthCheck] Testing STDIO MCP server...

stdout | tests/integration/routes/mcp.route.test.ts > MCP Routes > POST /api/mcp/health > should return health status for HTTP type
[HealthCheck] Testing HTTP MCP server...

stdout | tests/integration/routes/mcp.route.test.ts > MCP Routes > POST /api/mcp/connect > should connect and return tools/prompts/resources for STDIO
{ type: 'STDIO', command: 'test-command', args: [ 'arg1' ] }
STDIO

stdout | tests/integration/routes/mcp.route.test.ts > MCP Routes > POST /api/mcp/connect > should connect and return tools/prompts/resources for HTTP
{ type: 'HTTP', url: 'http://test-server.com' }
HTTP

stdout | tests/integration/routes/mcp.route.test.ts > MCP Routes > POST /api/mcp/stdio/connect > should connect to STDIO MCP server
{ command: 'test-command', args: [ 'arg1' ] }

 âœ“ tests/integration/routes/mcp.route.test.ts (15 tests) 143ms
 âœ“ tests/unit/nodes/JoinText.test.ts (9 tests) 5ms
stdout | tests/unit/nodes/HashNode.test.ts > HashNode > process > should hash input text using SHA256 by default
Executing Hash node 1 with input: hello world...
Hash node 1 generated sha256 hash: b94d27b9934d3e08...

stdout | tests/unit/nodes/HashNode.test.ts > HashNode > process > should hash input using MD5 when configured
Executing Hash node 1 with input: hello world...
Hash node 1 generated md5 hash: 5eb63bbbe01eeed0...

stdout | tests/unit/nodes/HashNode.test.ts > HashNode > process > should hash input using SHA1 when configured
Executing Hash node 1 with input: hello world...
Hash node 1 generated sha1 hash: 2aae6c35c94fcfb4...

stdout | tests/unit/nodes/HashNode.test.ts > HashNode > process > should hash input using SHA512 when configured
Executing Hash node 1 with input: hello world...
Hash node 1 generated sha512 hash: 309ecc489c12d6eb...

stdout | tests/unit/nodes/HashNode.test.ts > HashNode > process > should convert non-string input to string before hashing
Executing Hash node 1 with input: 12345...
Hash node 1 generated sha512 hash: 3627909a29c31381...

stdout | tests/unit/nodes/HashNode.test.ts > HashNode > process > should handle empty input
Executing Hash node 1 with input: ...
Hash node 1 generated sha512 hash: cf83e1357eefb8bd...

stdout | tests/unit/nodes/HashNode.test.ts > HashNode > process > should handle undefined input
Executing Hash node 1 with input: ...
Hash node 1 generated sha512 hash: cf83e1357eefb8bd...

stdout | tests/unit/nodes/HashNode.test.ts > HashNode > process > should handle errors gracefully
Executing Hash node 1 with input: test...
Hash node 1 generated sha512 hash: ee26b0dd4af7e749...

 âœ“ tests/unit/nodes/HashNode.test.ts (13 tests) 11ms
 âœ“ tests/basic.test.ts (2 tests) 2ms
stdout | tests/integration/websocket/socket.test.ts > WebSocket Server > should handle ping-pong messages
New WebSocket connection established: ::ffff:127.0.0.1

stdout | tests/integration/websocket/socket.test.ts > WebSocket Server > should handle ping-pong messages
Client Count: 1 Message:  ping

stdout | tests/integration/websocket/socket.test.ts > WebSocket Server > should send connected message on connection
New WebSocket connection established: ::ffff:127.0.0.1
WebSocket connection closed

 âœ“ tests/integration/routes/workflow.route.test.ts (1 test) 55ms
stdout | tests/integration/workflows/complex-workflow.test.ts > Complex Workflow Scenarios > Multi-node workflow execution > should execute a workflow with input -> process -> output nodes
Task Input: test input
Node 1 executed. Output: test input
Node 2 executed. Output: test input

stdout | tests/integration/workflows/complex-workflow.test.ts > Complex Workflow Scenarios > Multi-node workflow execution > should handle workflow with delay and timing
Task Input: delay test
Node 1 executed. Output: delay test

stdout | tests/integration/workflows/complex-workflow.test.ts > Complex Workflow Scenarios > Multi-node workflow execution > should handle workflow with delay and timing
Node 2 executed. Output: [object Object]

stdout | tests/integration/workflows/complex-workflow.test.ts > Complex Workflow Scenarios > Multi-node workflow execution > should handle JSON manipulation workflow
Task Input: {"user":{"name":"John","age":30}}
Node 1 executed. Output: {"user":{"name":"John","age":3
Executing JSONManipulator node 2
Node 2 executed. Output: [object Object]

stderr | tests/integration/workflows/complex-workflow.test.ts > Complex Workflow Scenarios > Multi-node workflow execution > should handle JSON manipulation workflow
Error in JSONManipulator node: Error: JSON input is required and must be a string
    at Object.process (/home/assem/work/yaLLMa3/yallma3-core/Workflow/Nodes/JSONManipulatorNode.ts:119:17)
    at /home/assem/work/yaLLMa3/yallma3-core/Workflow/runtime.ts:81:22
    at async Promise.all (index 0)
    at Module.executeFlowRuntime (/home/assem/work/yaLLMa3/yallma3-core/Workflow/runtime.ts:38:7)
    at /home/assem/work/yaLLMa3/yallma3-core/tests/integration/workflows/complex-workflow.test.ts:195:22
    at file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///home/assem/work/yaLLMa3/yallma3-core/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | tests/integration/workflows/complex-workflow.test.ts > Complex Workflow Scenarios > Multi-node workflow execution > should handle parallel node execution
Task Input: test
Node 1 executed. Output: test
Node 2 executed. Output: test
Node 3 executed. Output: test

 âœ“ tests/integration/workflows/complex-workflow.test.ts (4 tests) 1014ms
   âœ“ Complex Workflow Scenarios > Multi-node workflow execution > should handle workflow with delay and timing 1002ms
 âœ“ tests/unit/nodes/DelayNode.test.ts (9 tests) 3510ms
   âœ“ DelayNode > process > should delay for the specified time and pass input to output 1002ms
   âœ“ DelayNode > process > should use custom delay time from config parameter 501ms
   âœ“ DelayNode > process > should update node value to show current delay 2001ms
stdout | tests/integration/websocket/socket.test.ts > WebSocket Server > should handle console input messages
New WebSocket connection established: ::ffff:127.0.0.1
New WebSocket connection established: ::ffff:127.0.0.1
Client Count: 3 Message:  console_input
Received console input: { message: 'test input', type: 'user' }

stdout | tests/integration/websocket/socket.test.ts > WebSocket Server > should handle unknown message types gracefully
New WebSocket connection established: ::ffff:127.0.0.1
WebSocket connection closed
WebSocket connection closed
Client Count: 2 Message:  unknown_type
Unknown message type: unknown_type

stdout | tests/integration/websocket/socket.test.ts > WebSocket Server > should handle invalid JSON gracefully
New WebSocket connection established: ::ffff:127.0.0.1
WebSocket connection closed

stderr | tests/integration/websocket/socket.test.ts > WebSocket Server > should handle invalid JSON gracefully
Error parsing WebSocket message: SyntaxError: Unexpected token 'i', "invalid json" is not valid JSON
    at JSON.parse (<anonymous>)
    at WebSocket.<anonymous> (/home/assem/work/yaLLMa3/yallma3-core/Websocket/socket.ts:23:27)
    at WebSocket.emit (node:events:518:28)
    at Receiver.receiverOnMessage (/home/assem/work/yaLLMa3/yallma3-core/node_modules/ws/lib/websocket.js:1220:20)
    at Receiver.emit (node:events:518:28)
    at Receiver.dataMessage (/home/assem/work/yaLLMa3/yallma3-core/node_modules/ws/lib/receiver.js:596:14)
    at Receiver.getData (/home/assem/work/yaLLMa3/yallma3-core/node_modules/ws/lib/receiver.js:496:10)
    at Receiver.startLoop (/home/assem/work/yaLLMa3/yallma3-core/node_modules/ws/lib/receiver.js:167:16)
    at Receiver._write (/home/assem/work/yaLLMa3/yallma3-core/node_modules/ws/lib/receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:572:12)

 â¯ tests/integration/websocket/socket.test.ts (5 tests | 1 failed) 5136ms
   Ã— WebSocket Server > should send connected message on connection 5002ms
     â†’ Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
stdout | tests/integration/websocket/socket.test.ts
WebSocket connection closed


â¯â¯â¯â¯â¯â¯â¯ Failed Tests 1 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/integration/websocket/socket.test.ts > WebSocket Server > should send connected message on connection
Error: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/1]â¯

â¯â¯â¯â¯â¯â¯ Unhandled Errors â¯â¯â¯â¯â¯â¯

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

â¯â¯â¯â¯â¯ Uncaught Exception â¯â¯â¯â¯â¯
AssertionError: expected 'connected' to be 'error' // Object.is equality

Expected: "error"
Received: "connected"

 â¯ WebSocket.<anonymous> tests/integration/websocket/socket.test.ts:52:30
     50|       ws.on('message', (data) => {
     51|         const message = JSON.parse(data.toString()) as { type: string;â€¦
     52|         expect(message.type).toBe('error');
       |                              ^
     53|         expect(message.message).toBe('Invalid message format');
     54|         ws.close();
 â¯ WebSocket.emit node:events:518:28
 â¯ Receiver.receiverOnMessage node_modules/ws/lib/websocket.js:1220:20
 â¯ Receiver.emit node:events:518:28
 â¯ Receiver.dataMessage node_modules/ws/lib/receiver.js:596:14
 â¯ Receiver.getData node_modules/ws/lib/receiver.js:496:10
 â¯ Receiver.startLoop node_modules/ws/lib/receiver.js:167:16
 â¯ Receiver._write node_modules/ws/lib/receiver.js:94:10
 â¯ writeOrBuffer node:internal/streams/writable:572:12
 â¯ _write node:internal/streams/writable:501:10

This error originated in "tests/integration/websocket/socket.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should send connected message on connection". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯

 Test Files  1 failed | 12 passed (13)
      Tests  1 failed | 129 passed (130)
     Errors  1 error
   Start at  08:22:10
   Duration  6.39s (transform 1.09s, setup 0ms, collect 2.27s, tests 9.99s, environment 7ms, prepare 1.20s)

